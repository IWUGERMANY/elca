"undefined"!=typeof jQuery&&$(window).load(function(){jBlibs.App.init({debug:!0,updateHashUrlCssClass:"page",initialize:function(){},controllers:{lcc:{debug:!1,urls:/(^\/lcc|tab=lcc)/,controls:{"a:not(.no-xhr):not([rel])":{click:function(){return $(this).attr("href")}}},views:{"#content.lcc":["prepareContent"],"#tabContent.tab-lcc":"prepareCostsTable","#content.lcc-report-summary":"prepareSummaryReport","#content.lcc-report-progression":"prepareProgressionReport","#tabContent.elca-admin-benchmark-version":null},prepareContent:function($context){var self=this;$(".collapsible.close").each(function(){self.toggleSection(this,!0)}),$(".collapsible div.legend",$context).on("click",function(){self.toggleSection($(this).closest(".lcc-section"))}),$(".lcc-section .form-section.kguAlt input",$context).on("change",function(){var $self=$(this),$section=$self.closest(".lcc-section");$self.is(":checked")&&0==$self.val()?($section.find(".alt-group").hide(),$section.find(".list-group").show()):($section.find(".alt-group").show(),$section.find(".list-group").hide(),$section.removeClass("collapsible"),$section.find("div.legend").off("click"))})},prepareCostsTable:function($context){var self=this;$(".element-costs .toggle-link").each(function(){$(this).toggleSection($(".costs-table",$(this).parent()),"costs-table-visibility",null,self.initHorizontalTableScroll)}),$(".element-costs .toggle-link").click(function(e){$(this).toggleSection($(".costs-table",$(this).parent()),"costs-table-visibility",e,self.initHorizontalTableScroll)}),$("#section-summary .section-toggle").each(function(){$(this).click(function(){self.initHorizontalTableScroll(!$(this).hasClass("closed"))}),self.initHorizontalTableScroll(!$(this).hasClass("closed"))}),$("#compositeElementForm .form-section.costs input",$context).each(function(){var self=$(this),replacements=$(".replacements",self.closest("div.element"));self.val()?(replacements.show(),self.off("focus"),self.off("blur")):(replacements.hide(),self.on("focus",function(){replacements.show()}),self.on("blur",function(){self.val()||replacements.hide()}))})},initHorizontalTableScroll:function(isOpen){if(isOpen){var maxWidth=0;$(".tab-lcc .costs-table-width").each(function(){var $component=$(this);$(".costs-table table",$component).css("width","auto"),$(".costs-table table",$component).hide(),maxWidth=$component.first().outerWidth(),$(".costs-table table tbody tr.firstRow .fixed",$component).each(function(){maxWidth-=$(this).outerWidth()}),maxWidth-=.03*maxWidth,$(".costs-table table",$component).show(),$(".costs-table table",$component).outerWidth()>=maxWidth?($(".costs-table .scroll-wrapper",$component).addClass("scroll"),$(".costs-table .scroll-wrapper",$component).css("width",maxWidth),$(".costs-table table thead .legendRow .lastColumn",$component).css("width",maxWidth),$(".costs-table table",$component).css("width","auto")):$(".costs-table table",$component).css("width","98%")})}},toggleSection:function(section,doNotToggleClass){var $section=$(section),$legend=$("div.legend",section),$state=$section.find("input.toggle-state");$("input.changed",$section).length>0?($legend.siblings(":not(div.totals)").each(function(){$(this).is("div.headline")||$(this).find("input.changed,input[type=submit]").length||$(this).toggle()}),$legend.css("color","red")):$legend.siblings(":not(div.totals,div.alt-group,.form-section.kguAlt)").toggle(),doNotToggleClass||$section.toggleClass("close"),$state.val($section.hasClass("close")?1:0)},prepareSummaryReport:function($context){var $chart=$(".pie-chart",$context),data=$chart.data("values"),width=500,height=500,radius=Math.min(width,height)/2,color=d3.scale.ordinal().range(["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c","#ff8c00"]),arc=d3.svg.arc().outerRadius(radius-10).innerRadius(0),pie=d3.layout.pie().sort(null).value(function(d){return d.value}),svg=d3.select($chart[0]).append("svg").attr("width",width).attr("height",height).append("g").attr("transform","translate("+width/2+","+height/2+")");data.forEach(function(d){d.value=+d.value});var g=svg.selectAll(".arc").data(pie(data)).enter().append("g").attr("class","arc").attr("title",function(d){return d.data.tooltip});g.append("path").attr("d",arc).style("fill",function(d){return color(d.data.name)}),g.append("text").attr("transform",function(d){return"translate("+arc.centroid(d)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(d){return d.data.name})},prepareProgressionReport:function($context){var $chart=$(".line-chart",$context),series=$chart.data("values"),margin={top:20,right:200,bottom:30,left:50},width=.95*$context.innerWidth()-margin.left-margin.right,height=400-margin.top-margin.bottom,color=d3.scale.category10();$("div.tooltip").remove();var div=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),x=d3.scale.linear().range([0,width]),y=d3.scale.linear().range([height,0]),xAxis=d3.svg.axis().scale(x).orient("bottom"),yAxis=d3.svg.axis().scale(y).orient("left"),line=d3.svg.line().x(function(d){return x(d.lifeTime)}).y(function(d){return y(d.val)}),stepLine=d3.svg.line().x(function(d){return x(d.lifeTime)}).y(function(d){return y(d.val)}).interpolate("step-after"),svg=d3.select($chart[0]).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),allVals=[],maxLifeTime=0;if(series.forEach(function(item){item.values.forEach(function(d){d.lifeTime=+d.lifeTime,d.val=+d.val,allVals.push(d.val),maxLifeTime<d.lifeTime&&(maxLifeTime=d.lifeTime)})}),allVals.length){color.domain(series.map(function(d){return d.name})),x.domain([0,maxLifeTime]),y.domain(d3.extent(allVals)),svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis),svg.append("g").attr("class","y axis").call(yAxis).append("text").attr("x",5).attr("y",6).attr("dy","2px").style("text-anchor","start").text("â‚¬");var item=svg.selectAll(".item").data(series).enter().append("g").attr("class","item");item.append("path").attr("class","line").attr("d",function(d){return 0===d.id.search("KGU")?stepLine(d.values):line(d.values)}).style("stroke",function(d){return color(d.name)}),item.append("text").datum(function(d){return{name:d.name,value:d.values[d.values.length-1]}}).attr("transform",function(d){return d.value?"translate("+x(d.value.lifeTime)+","+y(d.value.val)+")":""}).attr("x",10).attr("dy",".35em").text(function(d){return d.name});var dot=item.append("g").attr("class","dots").style("fill",function(d){return color(d.name)});dot.selectAll("circle").data(function(d){return d.values}).enter().append("circle").attr("r","3").attr("cx",function(d){return x(d.lifeTime)}).attr("cy",function(d){return y(d.val)}).on("mouseover",function(d){div.transition().duration(200).style("opacity",.9),div.html(d.lifeTime+": "+d.tooltip).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(){div.transition().duration(500).style("opacity",0)})}}}}})});